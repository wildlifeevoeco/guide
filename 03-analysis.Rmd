# (PART) Analysis {-}

# Data science resources (generally)

Read [Advanced R](https://adv-r.hadley.nz/) and [Efficient R](https://csgillespie.github.io/efficientR/). 


Others

* [rOpenSci resources](https://ropensci.org/resources/)
* [StackOverflow R tag](https://stackoverflow.com/questions/tagged/r)
* [An aggregated list of free resources](https://github.com/alastairrushworth/free-data-science)


# data.table

`data.table` is Alec's favorite R package because it is incredibly efficient, 
lightweight and has incredibly responsive and dedicated developers (thank you!). `dplyr` and 
etc `tidyverse` packages are full of great functions and workflows, so check those
out as well. Life isn't about strange, strict binaries/camps - use what works
for you. 

<!-- **TODO: ALR basic resources, and grab from slides** -->

## Syntax

DT[i, j, by]


## Advanced: list columns
Use list columns to store a column of lists, or complex objects within a data.table. For example, models


[More details](http://brooksandrew.github.io/simpleblog/articles/advanced-data-table/#columns-of-lists)

## .SD

`.SD` = Subset of the Data.table

[Vignette](https://rdatatable.gitlab.io/data.table/articles/datatable-sd-usage.html)

##  CJ

CJ = Cross Join

For example: 

```{r}
library(data.table)

apples <- c('red', 'green')
butters <- c('peanut', 'almond')

DT <- CJ(apples, butters)
```

This is similar to the base function `expand.grid` but allows for results to be sorted and keys to be set. 


## .BY

The special symbol `.BY` stores the list of items in provided to the by. For example, in the above DT of apples and butters, we have two types of apples and butters. 

```{r}
DT[, print(.BY), by = butters]

DT[, print(.BY), by = apples]
```

We can use these in plots, subsetting other data.tables, etc. 

```{r}
library(ggplot2)

DT[, {print(qplot(apples, xlab = .BY[[1]])); 1}, by = butters]
```


## Resources {#dt-resources}
* [data.table website](https://rdatatable.gitlab.io/data.table/)
* [Andrew Brooks - Advanced data.table](http://brooksandrew.github.io/simpleblog/articles/advanced-data-table/)



## Slides {#dt-slides}
Workshop: Introduction to data.table

Date: November 16 2017

[Slides](https://slides.robitalec.ca/intro-data-table.html) and [Resources](https://gitlab.com/robit.a/workshops/-/archive/master/workshops-master.zip?path=intro-data-table)

```{r, echo = FALSE}
knitr::include_url('https://slides.robitalec.ca/intro-data-table.html')
```

# targets

`targets` is Alec's other favorite package. It is an tool for combining your 
functions and data into a full analysis pipeline. Targets (like predecessors
`drake` and GNU Make), monitors changes to data and R code to only rerun 
what you need to, when you need to. It has helped me build huge pipelines
with thousands of datasets, and many analytical steps. I won't attempt to 
introduce it here - the package is well documented by a dedicated, and incredibly
helpful developer (thanks!). The pay off here is huge, write functions in R
and easily rerun your analysis with one step (`tar_make()`).

Some projects in the lab that have used `targets` are:

* Alec's Movebank summarizer: [`move-book`](https://github.com/robitalec/move-book)
* Preparing animal movement data with [`prepare-locs`](https://github.com/robitalec/prepare-locs)
* [Caribou swimming paper](https://github.com/wildlifeevoeco/CaribouSwimming) (using `drake`)

# Spatial Analysis

## raster package

### Cropping a raster

To crop a raster to the extent of relocations:


```{r}
## Packages
library(data.table)
library(raster)
library(rasterVis)

## Load data
# DT is a data.table
load('data/DT.rda')

# DEM is a raster
load('data/dem.rda')

## Plot
# Plot raster and points
gplot(dem) +
	geom_tile(aes(fill = value)) +
	geom_point(aes(X, Y), data = DT)


## Crop to points
cropped <- crop(dem, DT[, as.matrix(cbind(X, Y))])

gplot(cropped) +
	geom_tile(aes(fill = value)) +
	geom_point(aes(X, Y), data = DT)
```

If you'd like to buffer the points first, use `sf`. 

```{r}
## Optionally buffer points first
library(sf)

pts <- st_as_sf(DT, coords = c('X', 'Y'))


buf <- st_buffer(pts, 1e4)


bufCropped <- crop(dem, buf)

gplot(bufCropped) +
	geom_tile(aes(fill = value)) +
	geom_point(aes(X, Y), data = DT)
```


## Data

Open sources: Open Street Map, Natural Earth, Canadian Government, Provincial Governments.

Examples of downloading and preparing spatial data from these sources in the [study-area-figures](https://gitlab.com/WEEL_grp/study-area-figures) repository (*-prep.R scripts).

Packages used for downloading data include: `osmdata`, `rnaturalearth` and `curl`. 



# Social Network Analysis

## Examples

**TODO: more examples**

[SocCaribou/Social Network Analysis](https://github.com/wildlifeevoeco/SocCaribou/blob/master/scripts/4-SocialNetworkAnalysis.R)


## Packages

### `spatsoc`

Alec, Quinn and Eric developed `spatsoc`, an R package for generating social networks from GPS data. 

Resources:

* [blog post](https://ropensci.org/blog/2018/12/04/spatsoc/)
* repository: [ropensci/spatsoc](https://github.com/ropensci/spatsoc/)
* vignettes, documentation: [docs.ropensci.org/spatsoc](https://docs.ropensci.org/spatsoc/)
* paper: [Conducting social network analysis with animal telemetry data: Applications and methods using spatsoc](https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/2041-210X.13215)
* [CSTWS webinar](https://slides.robitalec.ca/CSTWS-webinar-spatsoc.html)


### `hwig`

Alec developed `hwig`, an R package for calculating gregariousness adjusted half-weight index.

* repository: [robitalec/hwig](https://github.com/robitalec/hwig)


## Slides {#sna-slides}

<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vRMzDEm8bkxbERxRummBcgqHzOb2vLasEgJNsNC8r462hANEUCwu4dxDyVkdmroFCK7HFsIkhawKe_t/embed?start=false&loop=false&delayms=3000" frameborder="0" width="480" height="389" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>


# Behavioural Reaction Norms
## Slides {#brn-slides}

<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vTPmfrBj_WyLSq6AhmTXrAwxGDNzve3F7Dhgwr-01m9yU7WE2tDLttT-18MXrxTyg/embed?start=false&loop=false&delayms=3000" frameborder="0" width="480" height="389" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>





# Earth Engine
**TODO: ALR link to ee best practices, ee developers docs, your repo of scripts**


# Models

**TODO: add model summary tables, fake data**

# Cool Packages {#analysis-cool}

**TODO: organize into spatial/ plotting/ helper/ etc**

## Data frames / tables / sheets
* [`googlesheets4`](https://googlesheets4.tidyverse.org/)



## Dates and times
* [`anytime`](https://github.com/eddelbuettel/anytime) 
* [`parsedate`](https://github.com/gaborcsardi/parsedate) 

## Spatial packages


* [`parzer`](https://github.com/ropensci/parzer) parsing geographic coordinates


<!-- https://ropensci.org/packages/ -->
